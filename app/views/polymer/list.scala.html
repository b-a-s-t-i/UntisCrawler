@()
<link rel="import" href="@routes.Assets.at("polymer/bower_components/paper-tabs/paper-tabs.html")"
xmlns="http://www.w3.org/1999/html">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/core-animated-pages/core-animated-pages.html")">

<link rel="import" href="@routes.Assets.at("polymer/bower_components/polymer/polymer.html")">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/paper-input/paper-input-decorator.html")">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/paper-button/paper-button.html")">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/core-ajax/core-ajax.html")">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/paper-shadow/paper-shadow.html")">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/paper-item/paper-item.html")">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/paper-fab/paper-fab.html")">
<link rel="import" href="@routes.Assets.at("polymer/bower_components/core-icons/core-icons.html")">

<polymer-element name="master-list" constructor="MasterList" attribute="data">
    <template>
        <style>
        :host {
            display: block;
            padding: 8px;
            /*position: relative;*/
            /*background-color: #E5E5E5;*/
        }

        .card{
            margin: 8px;
            font-size: 14px;
            padding-left: 16px;
            padding-right: 16px;
            padding-bottom: 8px;
            padding-top: 8px;
            background: #fff;
            line-height: 1.5;
        }

        .cardhead{
            font-size: 24px;
            color: #FF9800;
            margin-bottom: 8px;
        }
        .list{
             max-height: 300px;
             overflow : auto ;
        }
        paper-tabs::shadow #selectionBar {
            background-color: #FF9800;
        }

        paper-tabs paper-tab::shadow #ink {
            color: #FF9800;
        }
        #paper_fab {
            background-color: rgb(253, 167, 41);
            display: none;
        }

        </style>
        <paper-shadow class="card" z="1" is="auto-binding" style="">

            <paper-tabs selected="{{selected}}" selectedindex="0">
                <template repeat="{{element in data}}">
                    <template if="{{element.elements}}">
                        <paper-tab inline flex center-center horizontal layout>{{element.elementTypeLabel | titleToString}}</paper-tab>
                    </template>
                </template>
            </paper-tabs>

            <core-animated-pages selected="{{selected}}" selectedindex="0" notap style="overflow:auto;height:300px;">
                <template repeat="{{e2 in data}}">
                    <template if="{{e2.elements}}">
                        <section>
                            <template repeat="{{e in e2.elements}}">
                                <paper-item>{{e.name}} - {{e.longName}}</paper-item>
                            </template>
                        </section>
                    </template>
                </template>
            </core-animated-pages>

            <div flex horizontal end-justified layout end>
                <paper-fab id="paper_fab" icon="account-circle" />
            </div>

        </paper-shadow>


        <core-ajax
            id="loadLists"
            url=""
            method="post"
            handleAs="json"
            on-core-response="{{handleListResponse}}"></core-ajax>

        <core-ajax
            id="loadUserData"
            url=""
            method="post"
            handleAs="json"
            on-core-response="{{handleUserDataResponse}}"></core-ajax>

    </template>

    <script>
        Polymer("master-list", {
            selected: 0,
            data: [],
            userData: null,
            noAccess: "No Access",

            loadData: function(loginSet){
                var urlLists = "/js/loadLists?";
                var urlUserData = "/js/userData?";

                var user = "se=" + encodeURIComponent(loginSet.server) +
                    "&sc=" + encodeURIComponent(loginSet.loginName) +
                    "&u=" + encodeURIComponent(loginSet.user) +
                    "&p=" + encodeURIComponent(loginSet.password);

                this.$.loadLists.url = urlLists + user;
                this.$.loadUserData.url = urlUserData + user;
                this.$.loadLists.go();
                this.$.loadUserData.go();
            },

            handleListResponse: function(event, data){
                this.data = [];
                this.data = data.response[0];
            },

            handleUserDataResponse: function(event, data){
                var user = data.response.result;
                var fab = this.$.paper_fab;

                if(user && user.personId !== 0 && user.personType !== 0){
                    fab.style.display = "block";
                    this.userData = user;
                }else{
                    fab.style.display = "none";
                }
            },

            titleToString: function(title){
                if(title === "IDC_KLASSE") return "Class";
                if(title === "IDC_LEHRER") return "Teacher";
                if(title === "IDC_RAUM") return "Room";
                if(title === "IDC_FACH") return "Subject";
            }

        });
    </script>

</polymer-element>